@page "/"

@using DM.BLL.Services
@using DocumentMaster.BlazorServer.Authentication
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@using Models
@using System.IO
@using Microsoft.AspNetCore.SignalR.Client



@inject NavigationManager Navigation
@inject IJSRuntime JS
@inject ProtectedSessionStorage sessionStorage
@inject PersonService PersonService
@inject MessageService MessageService




<PageTitle>Главная</PageTitle>

<AuthorizeView>
    <Authorized>
        <div class="row">
            <div class="col-9">
                <Schaduler></Schaduler>
            </div>
        </div>

    </Authorized>
    <NotAuthorized>
        <h1>Hello, Guest!</h1>
        <img src="/images/background.jpg" class="background" />
    </NotAuthorized>
</AuthorizeView>



@code
{
    [CascadingParameter]
    private Task<AuthenticationState> authenticationState { get; set; }

    private PersonDTO CurrentPerson { get; set; } = new();



    protected override async Task OnInitializedAsync()
    {

        var authState = await authenticationState;
        if (authState.User.Identities.FirstOrDefault().IsAuthenticated)
        {          
             CurrentPerson.UserName = authState.User.Claims
           .Where(c => c.Type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name")
            .FirstOrDefault().Value;

        }
    }

}