
@using DM.BLL.Services
@using DocumentMaster.BlazorServer.Authentication
@using DocumentMaster.BlazorServer.Pages
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@using Models

@inject PersonService PersonService
@inject DepartmentService DepartmentServices
@inject PositionService PositionService
@inject NavigationManager Navigation

<RadzenDialog />
<RadzenNotification />
<RadzenContextMenu />
<RadzenTooltip />

<AuthorizeView Roles="user,head">
    <Authorized>
        <RadzenTemplateForm Context="Cont" Data="@Person" Submit="@((PersonDTO args) => { Submit(args);})">
            <div class="row">
                <div class="col-md-10">
                    <RadzenFieldset Text="Личные данные">
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Имя"/>
                            </div>
                            
                            <div class="col-md-8">
                                <RadzenTextBox style="width: 50%;" @bind-Value="Person.FirstName" Name="FileName" />
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Фамилия" />
                            </div>
                            <div class="col-md-8">
                                <RadzenTextBox style="width: 50%;" @bind-Value="Person.LastName" Name="LastName" />
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Телеграм" />
                            </div>
                            <div class="col-md-8">
                                <RadzenTextBox style="width: 50%;" @bind-Value="Person.TelegramContact" Name="TG" />
                            </div>
                        </div>
                        
                    </RadzenFieldset>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-12 d-flex align-items-end justify-content-center" style="margin-top: 16px;">
                    <RadzenButton ButtonType="ButtonType.Submit" Icon="save" style="display: inline-block; margin-left: 10px;" Text="Save" />
                    <RadzenButton ButtonStyle="ButtonStyle.Light" Icon="cancel" style="display: inline-block; margin-left: 10px;" Text="Cancel" Click="@Cancel" />
                </div>
            </div>
        </RadzenTemplateForm>
    </Authorized>
</AuthorizeView>

<AuthorizeView Roles="admin">
    <Authorized>
        <RadzenTemplateForm Context="Cont" Data="@Person" Submit="@((PersonDTO args) => { Submit(args);})">
            <div class="row">
                <div class="col-md-10">
                    <RadzenFieldset Text="Личные данные">
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Имя" />
                            </div>

                            <div class="col-md-8">
                                <RadzenTextBox style="width: 50%;" @bind-Value="Person.FirstName" Name="FileName" />
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Фамилия" />
                            </div>
                            <div class="col-md-8">
                                <RadzenTextBox style="width: 50%;" @bind-Value="Person.LastName" Name="LastName" />
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Телеграм" />
                            </div>
                            <div class="col-md-8">
                                <RadzenTextBox style="width: 50%;" @bind-Value="Person.TelegramContact" Name="TG" />
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Отдел" />
                            </div>
                            <div class="col-md-8">
                                <RadzenDropDown @bind-Value="Person.DepartmentId" Data="@Departments" style="width: 80%;" 
                                TextProperty="Name" ValueProperty="Id" Name="Department"/>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Средняя оплата в час" />
                            </div>
                            <div class="col-md-8">
                                <RadzenTextBox style="width: 50%;" @bind-Value="Salary" Name="TG" />
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4 align-items-center d-flex">
                                <RadzenLabel Text="Средняя оплата в час" />
                            </div>
                            <div class="col-md-8">
                                <RadzenTextBox style="width: 50%;" @bind-Value="Salary" Name="TG" />
                            </div>
                        </div>

                    </RadzenFieldset>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-12 d-flex align-items-end justify-content-center" style="margin-top: 16px;">
                    <RadzenButton ButtonType="ButtonType.Submit" Icon="save" style="display: inline-block; margin-left: 10px;" Text="Save" />
                    <RadzenButton ButtonStyle="ButtonStyle.Light" Icon="cancel" style="display: inline-block; margin-left: 10px;" Text="Cancel" Click="@Cancel" />
                </div>
            </div>
        </RadzenTemplateForm>
    </Authorized>
</AuthorizeView>



@code {

    [CascadingParameter]
    private Task<AuthenticationState> authenticationState { get; set; }


    [Parameter]
    public PersonDTO Person { get; set; } = new PersonDTO();

    private IList<DepartmentDTO> Departments { get; set; }

    private string Salary { get; set; }

    protected override async void OnInitialized()
    {
        if (Departments is null)
        {          
            var d = await DepartmentServices.GetDepartmentsListAsync();
            Departments = d.ToList();
        }
    }

    protected override void OnParametersSet()
    {
        if (Person == null)
        {

        }



    }

    async void Submit(PersonDTO arg)
    {
        await PersonService.UpdatePersonAsync(arg);
    }

        async void Cancel()
    {
        Navigation.NavigateTo("/");
    }
 }
