@using DM.DAL.Models
@using Models
@using DM.BLL.Services


@implements IDisposable


@inject DialogService DialogService



    <RadzenButton Text="На проверку" ButtonStyle="ButtonStyle.Secondary" 
Click=@OpenSendToCheckDialog />


@code {

    [Parameter]
    public IList<FileUnit> SelectedFiles { get; set; }

    [Parameter]
    public EventCallback<bool> SendedToCheck { get; set; }

    private bool IsSended { get; set; } = false;






    protected override void OnInitialized()
    {
        DialogService.OnOpen += Open;
        DialogService.OnClose += Close;
    }

    private async Task OpenSendToCheckDialog()
    {

        var result= await DialogService.OpenAsync<SendToCheckDialog>($"На проверку",
              new Dictionary<string, object>() { { "SelectedFile", SelectedFiles.First() } },
              new DialogOptions() 
              { Width = "700px", Height = "550px", Resizable = true
              , Draggable = false, CloseDialogOnOverlayClick = true });
        if (result is not null)
        {
            IsSended = (bool)result;
            SendedToCheck.InvokeAsync(IsSended);

        }

    }

    void Open(string title, Type type, Dictionary<string, object> parameters, DialogOptions options)
    {

    }

    void Close(dynamic result)
    {
        Dispose();
    }

    public void Dispose()
    {
        // The DialogService is a singleton so it is advisable to unsubscribe.
        DialogService.OnOpen -= Open;
        DialogService.OnClose -= Close;
    }

}
